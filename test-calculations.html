<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è¨ˆç®—é‚è¼¯è‡ªå‹•åŒ–æ¸¬è©¦</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 1000px;
            margin: 20px auto;
            padding: 20px;
            background: #f5f5f5;
        }
        h1 {
            color: #2c3e50;
            border-bottom: 3px solid #3498db;
            padding-bottom: 10px;
        }
        h2 {
            color: #34495e;
            margin-top: 30px;
            background: #ecf0f1;
            padding: 10px;
            border-left: 4px solid #3498db;
        }
        .test-suite {
            background: white;
            padding: 20px;
            margin: 15px 0;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .test-case {
            margin: 10px 0;
            padding: 10px;
            border-left: 3px solid #95a5a6;
        }
        .test-case.pass {
            border-left-color: #27ae60;
            background: #d5f4e6;
        }
        .test-case.fail {
            border-left-color: #e74c3c;
            background: #fadbd8;
        }
        .test-result {
            font-weight: bold;
            display: inline-block;
            min-width: 60px;
        }
        .pass .test-result { color: #27ae60; }
        .fail .test-result { color: #e74c3c; }
        .summary {
            background: #3498db;
            color: white;
            padding: 20px;
            border-radius: 8px;
            margin: 20px 0;
            font-size: 18px;
        }
        .summary.all-pass {
            background: #27ae60;
        }
        .summary.has-fail {
            background: #e74c3c;
        }
        .detail {
            font-family: 'Courier New', monospace;
            font-size: 12px;
            color: #7f8c8d;
            margin-left: 70px;
        }
        button {
            background: #3498db;
            color: white;
            border: none;
            padding: 12px 24px;
            font-size: 16px;
            border-radius: 5px;
            cursor: pointer;
            margin: 10px 0;
        }
        button:hover {
            background: #2980b9;
        }
    </style>
</head>
<body>
    <h1>ğŸ”¬ è¨ˆç®—é‚è¼¯è‡ªå‹•åŒ–æ¸¬è©¦</h1>
    <p><strong>ç›®çš„</strong>: ç¢ºä¿é‡æ§‹å¾Œæ‰€æœ‰è¨ˆç®—é‚è¼¯èˆ‡é‡æ§‹å‰å®Œå…¨ä¸€è‡´</p>

    <button onclick="runAllTests()">â–¶ åŸ·è¡Œæ‰€æœ‰æ¸¬è©¦</button>

    <div id="summary"></div>
    <div id="results"></div>

    <!-- è¼‰å…¥é…ç½®å’Œå‡½æ•¸ -->
    <script src="js/config.js"></script>
    <script src="js/common.js"></script>

    <script>
        // ===================================================================
        // æ¸¬è©¦æ¡†æ¶
        // ===================================================================

        let totalTests = 0;
        let passedTests = 0;
        let failedTests = 0;
        const testResults = [];

        function assert(testName, condition, expected, actual, formula) {
            totalTests++;
            const pass = condition;

            if (pass) {
                passedTests++;
            } else {
                failedTests++;
            }

            testResults.push({
                name: testName,
                pass: pass,
                expected: expected,
                actual: actual,
                formula: formula
            });
        }

        function assertClose(testName, actual, expected, tolerance, formula) {
            const diff = Math.abs(actual - expected);
            const pass = diff <= tolerance;

            totalTests++;
            if (pass) {
                passedTests++;
            } else {
                failedTests++;
            }

            testResults.push({
                name: testName,
                pass: pass,
                expected: expected,
                actual: actual,
                formula: formula,
                diff: diff
            });
        }

        // ===================================================================
        // æ¸¬è©¦å¥—ä»¶ 1: é…ç½®å¸¸æ•¸é©—è­‰
        // ===================================================================

        function testConfigConstants() {
            const results = [];

            // æ¸¬è©¦ CONFIG æ˜¯å¦å­˜åœ¨ï¼ˆå‘å¾Œå…¼å®¹ï¼‰
            assert(
                'CONFIG ç‰©ä»¶å­˜åœ¨',
                typeof CONFIG !== 'undefined',
                'defined',
                typeof CONFIG,
                'typeof CONFIG'
            );

            // æ¸¬è©¦ APP_CONFIG æ˜¯å¦å­˜åœ¨
            assert(
                'APP_CONFIG ç‰©ä»¶å­˜åœ¨',
                typeof APP_CONFIG !== 'undefined',
                'defined',
                typeof APP_CONFIG,
                'typeof APP_CONFIG'
            );

            // æ¸¬è©¦æ°‘åœ‹å¹´è½‰æ›åç§»å€¼
            assert(
                'æ°‘åœ‹å¹´è½‰æ›åç§»å€¼ = 1911',
                CONFIG.ROC_TO_AD_OFFSET === 1911,
                1911,
                CONFIG.ROC_TO_AD_OFFSET,
                'CONFIG.ROC_TO_AD_OFFSET'
            );

            // æ¸¬è©¦å‹ä¿è²»ç‡
            assert(
                'å‹ä¿è²»ç‡ = 0.7 (70%)',
                CONFIG.LABOR_INSURANCE_RATE === 0.7,
                0.7,
                CONFIG.LABOR_INSURANCE_RATE,
                'CONFIG.LABOR_INSURANCE_RATE'
            );

            // æ¸¬è©¦å¥ä¿è²»ç‡
            assert(
                'å¥ä¿è²»ç‡ = 0.6 (60%)',
                CONFIG.HEALTH_INSURANCE_RATE === 0.6,
                0.6,
                CONFIG.HEALTH_INSURANCE_RATE,
                'CONFIG.HEALTH_INSURANCE_RATE'
            );

            // æ¸¬è©¦ç‡Ÿæ¥­ç¨…ç‡
            assert(
                'ç‡Ÿæ¥­ç¨…ç‡ = 0.05 (5%)',
                CONFIG.VAT_RATE === 0.05,
                0.05,
                CONFIG.VAT_RATE,
                'CONFIG.VAT_RATE'
            );

            // æ¸¬è©¦å«ç¨…ä¹˜æ•¸
            assert(
                'å«ç¨…ä¹˜æ•¸ = 1.05',
                CONFIG.VAT_MULTIPLIER === 1.05,
                1.05,
                CONFIG.VAT_MULTIPLIER,
                'CONFIG.VAT_MULTIPLIER'
            );
        }

        // ===================================================================
        // æ¸¬è©¦å¥—ä»¶ 2: å‹å¥ä¿è¨ˆç®—
        // ===================================================================

        function testLaborInsuranceCalculations() {
            // æ¸¬è©¦æ¡ˆä¾‹ 1: å‹ä¿è²» 10000 * 0.7 = 7000
            const labor1 = Math.round(10000 * CONFIG.LABOR_INSURANCE_RATE);
            assert(
                'å‹ä¿è²»è¨ˆç®—: 10000 * 0.7',
                labor1 === 7000,
                7000,
                labor1,
                'Math.round(10000 * 0.7)'
            );

            // æ¸¬è©¦æ¡ˆä¾‹ 2: å¥ä¿è²» 10000 * 0.6 = 6000
            const health1 = Math.round(10000 * CONFIG.HEALTH_INSURANCE_RATE);
            assert(
                'å¥ä¿è²»è¨ˆç®—: 10000 * 0.6',
                health1 === 6000,
                6000,
                health1,
                'Math.round(10000 * 0.6)'
            );

            // æ¸¬è©¦æ¡ˆä¾‹ 3: å‹ä¿è²» 15327 * 0.7 = 10729
            const labor2 = Math.round(15327 * CONFIG.LABOR_INSURANCE_RATE);
            assert(
                'å‹ä¿è²»è¨ˆç®—: 15327 * 0.7',
                labor2 === 10729,
                10729,
                labor2,
                'Math.round(15327 * 0.7)'
            );

            // æ¸¬è©¦æ¡ˆä¾‹ 4: å¥ä¿è²» 8763 * 0.6 = 5258
            const health2 = Math.round(8763 * CONFIG.HEALTH_INSURANCE_RATE);
            assert(
                'å¥ä¿è²»è¨ˆç®—: 8763 * 0.6',
                health2 === 5258,
                5258,
                health2,
                'Math.round(8763 * 0.6)'
            );
        }

        // ===================================================================
        // æ¸¬è©¦å¥—ä»¶ 3: ç‡Ÿæ¥­ç¨…è¨ˆç®—
        // ===================================================================

        function testVATCalculations() {
            // æ¸¬è©¦æ¡ˆä¾‹ 1: äºŒè¯å¼ - ç¸½è¨ˆ 1050ï¼Œæ¨ç®—éŠ·å”®é¡å’Œç¨…é¡
            const total1 = 1050;
            const sales1 = Math.round(total1 / CONFIG.VAT_MULTIPLIER);
            const tax1 = total1 - sales1;

            assert(
                'äºŒè¯å¼éŠ·å”®é¡: 1050 / 1.05 = 1000',
                sales1 === 1000,
                1000,
                sales1,
                'Math.round(1050 / 1.05)'
            );

            assert(
                'äºŒè¯å¼ç¨…é¡: 1050 - 1000 = 50',
                tax1 === 50,
                50,
                tax1,
                '1050 - 1000'
            );

            // æ¸¬è©¦æ¡ˆä¾‹ 2: ä¸‰è¯å¼ - éŠ·å”®é¡ 2000ï¼Œæ¨ç®—ç¨…é¡å’Œç¸½è¨ˆ
            const sales2 = 2000;
            const tax2 = Math.round(sales2 * CONFIG.VAT_RATE);
            const total2 = sales2 + tax2;

            assert(
                'ä¸‰è¯å¼ç¨…é¡: 2000 * 0.05 = 100',
                tax2 === 100,
                100,
                tax2,
                'Math.round(2000 * 0.05)'
            );

            assert(
                'ä¸‰è¯å¼ç¸½è¨ˆ: 2000 + 100 = 2100',
                total2 === 2100,
                2100,
                total2,
                '2000 + 100'
            );

            // æ¸¬è©¦æ¡ˆä¾‹ 3: è¤‡é›œæ•¸å­— - ç¸½è¨ˆ 3276
            const total3 = 3276;
            const sales3 = Math.round(total3 / CONFIG.VAT_MULTIPLIER);
            const tax3 = total3 - sales3;

            assert(
                'äºŒè¯å¼éŠ·å”®é¡: 3276 / 1.05 = 3120',
                sales3 === 3120,
                3120,
                sales3,
                'Math.round(3276 / 1.05)'
            );

            assert(
                'äºŒè¯å¼ç¨…é¡: 3276 - 3120 = 156',
                tax3 === 156,
                156,
                tax3,
                '3276 - 3120'
            );
        }

        // ===================================================================
        // æ¸¬è©¦å¥—ä»¶ 4: æ—¥æœŸè½‰æ›å‡½æ•¸
        // ===================================================================

        function testDateConversions() {
            // æ¸¬è©¦æ°‘åœ‹å¹´è½‰è¥¿å…ƒå¹´
            assert(
                'æ°‘åœ‹113å¹´ â†’ è¥¿å…ƒ2024å¹´',
                rocToAD(113) === 2024,
                2024,
                rocToAD(113),
                'rocToAD(113)'
            );

            assert(
                'æ°‘åœ‹1å¹´ â†’ è¥¿å…ƒ1912å¹´',
                rocToAD(1) === 1912,
                1912,
                rocToAD(1),
                'rocToAD(1)'
            );

            assert(
                'æ°‘åœ‹150å¹´ â†’ è¥¿å…ƒ2061å¹´',
                rocToAD(150) === 2061,
                2061,
                rocToAD(150),
                'rocToAD(150)'
            );

            // æ¸¬è©¦è¥¿å…ƒå¹´è½‰æ°‘åœ‹å¹´
            assert(
                'è¥¿å…ƒ2024å¹´ â†’ æ°‘åœ‹113å¹´',
                adToROC(2024) === 113,
                113,
                adToROC(2024),
                'adToROC(2024)'
            );

            assert(
                'è¥¿å…ƒ1912å¹´ â†’ æ°‘åœ‹1å¹´',
                adToROC(1912) === 1,
                1,
                adToROC(1912),
                'adToROC(1912)'
            );

            // æ¸¬è©¦æ°‘åœ‹å¹´ç¯„åœé©—è­‰
            assert(
                'æ°‘åœ‹113å¹´ - æœ‰æ•ˆ',
                isValidROCYear(113) === true,
                true,
                isValidROCYear(113),
                'isValidROCYear(113)'
            );

            assert(
                'æ°‘åœ‹0å¹´ - ç„¡æ•ˆ',
                isValidROCYear(0) === false,
                false,
                isValidROCYear(0),
                'isValidROCYear(0)'
            );

            assert(
                'æ°‘åœ‹201å¹´ - ç„¡æ•ˆ (è¶…éä¸Šé™)',
                isValidROCYear(201) === false,
                false,
                isValidROCYear(201),
                'isValidROCYear(201)'
            );
        }

        // ===================================================================
        // æ¸¬è©¦å¥—ä»¶ 5: é–å¹´åˆ¤æ–·
        // ===================================================================

        function testLeapYears() {
            assert(
                '2024å¹´æ˜¯é–å¹´',
                isLeapYear(2024) === true,
                true,
                isLeapYear(2024),
                'isLeapYear(2024)'
            );

            assert(
                '2023å¹´ä¸æ˜¯é–å¹´',
                isLeapYear(2023) === false,
                false,
                isLeapYear(2023),
                'isLeapYear(2023)'
            );

            assert(
                '2000å¹´æ˜¯é–å¹´ (400å€æ•¸)',
                isLeapYear(2000) === true,
                true,
                isLeapYear(2000),
                'isLeapYear(2000)'
            );

            assert(
                '1900å¹´ä¸æ˜¯é–å¹´ (100å€æ•¸ä½†é400å€æ•¸)',
                isLeapYear(1900) === false,
                false,
                isLeapYear(1900),
                'isLeapYear(1900)'
            );

            // æ¸¬è©¦å¹´ä»½å¤©æ•¸
            assert(
                '2024å¹´æœ‰366å¤©',
                getDaysInYear(2024) === 366,
                366,
                getDaysInYear(2024),
                'getDaysInYear(2024)'
            );

            assert(
                '2023å¹´æœ‰365å¤©',
                getDaysInYear(2023) === 365,
                365,
                getDaysInYear(2023),
                'getDaysInYear(2023)'
            );
        }

        // ===================================================================
        // æ¸¬è©¦å¥—ä»¶ 6: ä¿éšªè²»åˆ†æ”¤è¨ˆç®—ï¼ˆæ•´åˆæ¸¬è©¦ï¼‰
        // ===================================================================

        function testPremiumAllocation() {
            // ç°¡åŒ–çš„ä¿éšªè²»åˆ†æ”¤é‚è¼¯æ¸¬è©¦
            // æ¸¬è©¦æ¡ˆä¾‹ï¼š113/3/30 ~ 114/3/23ï¼Œç¸½ä¿è²» 36500

            const startDate = new Date(2024, 2, 30); // 2024/3/30
            const endDate = new Date(2025, 2, 23);   // 2025/3/23
            const totalPremium = 36500;

            // è¨ˆç®—ç¸½å¤©æ•¸
            const totalDays = Math.floor(
                (Date.UTC(endDate.getFullYear(), endDate.getMonth(), endDate.getDate()) -
                 Date.UTC(startDate.getFullYear(), startDate.getMonth(), startDate.getDate())) /
                (1000 * 60 * 60 * 24)
            );

            assert(
                'è¨ˆç®—ç¸½å¤©æ•¸: 2024/3/30 ~ 2025/3/23',
                totalDays === 358,
                358,
                totalDays,
                'æ—¥æœŸå·®è¨ˆç®—'
            );

            // æ¸¬è©¦ç¬¬ä¸€å¹´å¤©æ•¸ï¼ˆ2024å¹´ï¼š3/30 ~ 12/31ï¼‰
            const firstYearDays = getDaysInYear(2024) - dayOfYear(startDate);
            assertClose(
                '2024å¹´åº¦å¤©æ•¸',
                firstYearDays,
                277, // 366 - 89 = 277
                1,
                'getDaysInYear(2024) - dayOfYear(startDate)'
            );

            // æ¸¬è©¦ç¬¬äºŒå¹´å¤©æ•¸ï¼ˆ2025å¹´ï¼š1/1 ~ 3/23ï¼‰
            const secondYearDays = dayOfYear(endDate);
            assertClose(
                '2025å¹´åº¦å¤©æ•¸',
                secondYearDays,
                82, // 1æœˆ31 + 2æœˆ28 + 3æœˆ23 = 82
                1,
                'dayOfYear(endDate)'
            );
        }

        // ===================================================================
        // åŸ·è¡Œæ‰€æœ‰æ¸¬è©¦
        // ===================================================================

        function runAllTests() {
            // é‡ç½®è¨ˆæ•¸å™¨
            totalTests = 0;
            passedTests = 0;
            failedTests = 0;
            testResults.length = 0;

            // åŸ·è¡Œæ‰€æœ‰æ¸¬è©¦å¥—ä»¶
            testConfigConstants();
            testLaborInsuranceCalculations();
            testVATCalculations();
            testDateConversions();
            testLeapYears();
            testPremiumAllocation();

            // é¡¯ç¤ºçµæœ
            displayResults();
        }

        function displayResults() {
            const summaryDiv = document.getElementById('summary');
            const resultsDiv = document.getElementById('results');

            // é¡¯ç¤ºæ‘˜è¦
            const passRate = ((passedTests / totalTests) * 100).toFixed(1);
            const summaryClass = failedTests === 0 ? 'all-pass' : 'has-fail';

            summaryDiv.className = `summary ${summaryClass}`;
            summaryDiv.innerHTML = `
                <div style="font-size: 24px; margin-bottom: 10px;">
                    ${failedTests === 0 ? 'âœ… æ‰€æœ‰æ¸¬è©¦é€šéï¼' : 'âŒ æœ‰æ¸¬è©¦å¤±æ•—ï¼'}
                </div>
                <div>
                    ç¸½è¨ˆ: ${totalTests} å€‹æ¸¬è©¦ |
                    é€šé: ${passedTests} |
                    å¤±æ•—: ${failedTests} |
                    é€šéç‡: ${passRate}%
                </div>
                ${failedTests === 0 ?
                    '<div style="margin-top: 10px; font-size: 16px;">ğŸ‰ è¨ˆç®—é‚è¼¯å®Œå…¨ä¸€è‡´ï¼Œå¯ä»¥å®‰å¿ƒé‡æ§‹ï¼</div>' :
                    '<div style="margin-top: 10px; font-size: 16px;">âš ï¸ è«‹æª¢æŸ¥å¤±æ•—çš„æ¸¬è©¦æ¡ˆä¾‹</div>'
                }
            `;

            // é¡¯ç¤ºè©³ç´°çµæœ
            let html = '';
            let currentSuite = '';

            testResults.forEach((result, index) => {
                // æ ¹æ“šæ¸¬è©¦åç¨±åˆ¤æ–·å±¬æ–¼å“ªå€‹æ¸¬è©¦å¥—ä»¶
                const suiteName = getSuiteName(index);

                if (suiteName !== currentSuite) {
                    if (currentSuite !== '') {
                        html += '</div>';
                    }
                    html += `<div class="test-suite"><h2>${suiteName}</h2>`;
                    currentSuite = suiteName;
                }

                const statusIcon = result.pass ? 'âœ“' : 'âœ—';
                const statusClass = result.pass ? 'pass' : 'fail';
                const statusText = result.pass ? 'PASS' : 'FAIL';

                html += `
                    <div class="test-case ${statusClass}">
                        <span class="test-result">${statusIcon} ${statusText}</span>
                        ${result.name}
                        <div class="detail">
                            æœŸæœ›: ${result.expected} | å¯¦éš›: ${result.actual}
                            ${result.diff !== undefined ? ` | å·®ç•°: ${result.diff}` : ''}
                            <br>å…¬å¼: ${result.formula}
                        </div>
                    </div>
                `;
            });

            if (currentSuite !== '') {
                html += '</div>';
            }

            resultsDiv.innerHTML = html;
        }

        function getSuiteName(index) {
            if (index < 7) return 'ğŸ“‹ æ¸¬è©¦å¥—ä»¶ 1: é…ç½®å¸¸æ•¸é©—è­‰';
            if (index < 11) return 'ğŸ’° æ¸¬è©¦å¥—ä»¶ 2: å‹å¥ä¿è¨ˆç®—';
            if (index < 18) return 'ğŸ§¾ æ¸¬è©¦å¥—ä»¶ 3: ç‡Ÿæ¥­ç¨…è¨ˆç®—';
            if (index < 27) return 'ğŸ“… æ¸¬è©¦å¥—ä»¶ 4: æ—¥æœŸè½‰æ›å‡½æ•¸';
            if (index < 33) return 'ğŸ“† æ¸¬è©¦å¥—ä»¶ 5: é–å¹´åˆ¤æ–·';
            return 'ğŸ”¢ æ¸¬è©¦å¥—ä»¶ 6: ä¿éšªè²»åˆ†æ”¤è¨ˆç®—';
        }

        // é é¢è¼‰å…¥æ™‚è‡ªå‹•åŸ·è¡Œæ¸¬è©¦
        window.addEventListener('load', function() {
            setTimeout(runAllTests, 100);
        });
    </script>
</body>
</html>
